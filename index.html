<!doctype html>
<html lang="zh-Hans">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-title" content="Yoyi-Reading" />
  <meta name="theme-color" content="#F6EFFF" />

  <title>Yoyi-Reading</title>

  <!-- Iconï¼ˆå¯é€‰ï¼šå¦‚æœä½ ä»“åº“é‡Œæœ‰è¿™äº›æ–‡ä»¶ï¼Œä¼šè‡ªåŠ¨ç”Ÿæ•ˆï¼›æ²¡æœ‰ä¹Ÿä¸å½±å“ä½¿ç”¨ï¼‰ -->
  <link rel="apple-touch-icon" href="apple-touch-icon.png" />
  <link rel="icon" href="icon.png" />
  <!-- ä½ çš„ä»“åº“é‡Œç›®å‰æœ‰ IMG_9659.png ç­‰æ–‡ä»¶åï¼Œè¿™é‡Œä¹ŸåŠ ä¸€ä¸ªå…œåº• -->
  <link rel="icon" href="IMG_9659.png" />

  <style>
    :root{
      --bg1:#f7f0ff;
      --bg2:#ffeef6;
      --card:#ffffffcc;
      --ink:#1f2430;
      --muted:#5c6170;
      --stroke:#ffffffa8;
      --shadow: 0 18px 60px rgba(40, 20, 90, .12);
      --shadow2: 0 10px 30px rgba(40, 20, 90, .10);
      --radius:22px;
      --radius2:16px;
      --accent:#6c63ff;
      --accent2:#b56cff;
      --danger:#ff4d4f;
      --ok:#24a148;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: -apple-system,BlinkMacSystemFont,"SF Pro Text","PingFang SC","Noto Sans SC",system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;
      color:var(--ink);
      background: radial-gradient(1200px 800px at 20% 10%, var(--bg1) 0%, transparent 55%),
                  radial-gradient(1000px 700px at 90% 10%, var(--bg2) 0%, transparent 55%),
                  linear-gradient(180deg, #fff 0%, #faf7ff 40%, #fff 100%);
      overflow-x:hidden;
      min-height:100vh;
    }
    .wrap{
      max-width: 980px;
      margin: 0 auto;
      overflow-x:hidden;
      padding: 20px 14px 60px;
    }
    .hero{
      background: linear-gradient(135deg, rgba(108,99,255,.12), rgba(181,108,255,.10));
      border:1px solid var(--stroke);
      box-shadow: var(--shadow);
      border-radius: var(--radius);
      padding: 18px 16px 16px;
      backdrop-filter: blur(10px);
    }
    .top{
      display:flex;
      align-items:flex-start;
      gap: 12px;
    }
    .badge{
      width:56px;height:56px;
      border-radius: 16px;
      display:flex;align-items:center;justify-content:center;
      background: linear-gradient(135deg, rgba(108,99,255,.22), rgba(255,192,203,.18));
      border:1px solid rgba(255,255,255,.75);
      box-shadow: var(--shadow2);
      flex:0 0 auto;
      font-size: 28px;
    }
    h1{
      margin: 0;
      font-size: 30px;
      line-height: 1.05;
      letter-spacing: .2px;
    }
    .subtitle{
      margin: 6px 0 0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.25;
    }

.chips{
  margin-top: 10px;
  display:flex;
  flex-wrap: nowrap;   /* â† æŠŠ wrap æ”¹æˆ nowrap */
  gap:8px;
  overflow-x: auto;    /* â† æ–°å¢ï¼šä¸å¤Ÿå°±æ¨ªå‘æ»‘åŠ¨ï¼Œä¸æ¢è¡Œ */
  -webkit-overflow-scrolling: touch; /* â† iOS æ»‘åŠ¨æ›´é¡º */
}
    .chip{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 5px 10px;
      border-radius: 999px;
      background: rgba(255,255,255,.65);
      border:1px solid rgba(255,255,255,.7);
      color: var(--muted);
      font-size: 12px;
      box-shadow: 0 8px 18px rgba(40,20,90,.06);
white-space: nowrap;

    }

    .grid{
      margin-top: 16px;
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap: 14px;
    }
    @media (max-width: 820px){
      .grid{ grid-template-columns: 1fr; }
    }
    .card{
      background: var(--card);
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      box-shadow: var(--shadow2);
      padding: 14px;
      backdrop-filter: blur(10px);
    }
    .sectionTitle{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom:10px;
    }
    .sectionTitle h2{
      margin:0;
      font-size: 18px;
      letter-spacing:.2px;
      display:flex;
      align-items:center;
      gap:10px;
    }
    .rightTools{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }

    /* Year filter */
    .select{
      appearance:none;
      -webkit-appearance:none;
      border:1px solid rgba(255,255,255,.8);
      background: rgba(255,255,255,.75);
      color: var(--ink);
      padding: 10px 38px 10px 12px;
      border-radius: 14px;
      font-size: 14px;
      box-shadow: 0 8px 18px rgba(40,20,90,.06);
      position: relative;
      outline: none;
      cursor: pointer;
    }
    .selectWrap{
      position: relative;
      display:inline-block;
    }
    .selectWrap:after{
      content:"â–¾";
      position:absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-52%);
      color: var(--muted);
      pointer-events:none;
      font-size: 14px;
    }

    /* Stats */
    .stats{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin-top: 12px;
    }
    .stat{
      background: rgba(255,255,255,.72);
      border:1px dashed rgba(108,99,255,.22);
      border-radius: 16px;
      padding: 12px;
      text-align:center;
      box-shadow: 0 8px 18px rgba(40,20,90,.05);
    }
    .stat .v{ font-size: 26px; font-weight: 800; letter-spacing:.2px; }
    .stat .k{ margin-top:4px; color: var(--muted); font-size: 13px; }

    /* Form */
    .formGrid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 10px;
    }
    .row2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    @media (max-width: 520px){
      .row2{ grid-template-columns: 1fr; }
    }
    label{
      display:block;
      font-weight: 700;
      font-size: 14px;
      margin: 2px 0 6px;
      color: #2a2f3d;
    }
    input{
      width:100%;
      padding: 12px 12px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.85);
      background: rgba(255,255,255,.70);
      outline: none;
      font-size: 15px;
      color: var(--ink);
      box-shadow: 0 8px 18px rgba(40,20,90,.05);
    }
    input::placeholder{ color: rgba(92,97,112,.75); }
    .hint{
      color: var(--muted);
      font-size: 12px;
      margin-top: 6px;
      line-height: 1.35;
    }

    /* Stars */
    .stars{
      display:flex;
      align-items:center;
      gap:8px;
      padding: 10px 10px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.85);
      background: rgba(255,255,255,.70);
      box-shadow: 0 8px 18px rgba(40,20,90,.05);
    }
    .starBtn{
      width: 40px; height: 40px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.9);
      background: rgba(255,255,255,.8);
      cursor:pointer;
      display:flex; align-items:center; justify-content:center;
      font-size: 22px;
      transition: transform .06s ease;
      user-select:none;
    }
    .starBtn:active{ transform: scale(.96); }
    .starBtn.on{
      background: rgba(255, 241, 170, .9);
      border-color: rgba(255, 223, 100, .95);
      box-shadow: 0 8px 18px rgba(255, 200, 20, .14);
    }
    .starNote{ color: var(--muted); font-size: 13px; margin-left: 6px; }

    /* Buttons */

/* =========================
   Buttons â€“ æœ€ç»ˆç¨³å®šç‰ˆ
   ========================= */

/* æ‰€æœ‰æŒ‰é’®ï¼šå½»åº•å» iOS è“å­— */
button{
  appearance: none;
  -webkit-appearance: none;
  border: none;
  cursor: pointer;
  font-family: inherit;
  color: #111827;
  -webkit-text-fill-color: #111827;
}

/* æŒ‰é’®è¡Œï¼ˆåŸºç¡€ï¼‰ */
.btnRow{
  display: flex;
  gap: 8px;
  margin-top: 12px;
}

/* ===== ä¸Šæ–¹ä¸‰æŒ‰é’®ï¼šå¼ºåˆ¶ä¸€è¡Œ ===== */
.actionRow{
  flex-wrap: nowrap;
}
/* ä¸Šæ–¹ä¸‰æŒ‰é’®ï¼šæ›´è½»ã€æ›´è–„ */
.actionRow button{
  flex: 1 1 0;
  padding: 9px 8px;
  border-radius: 16px;
  font-size: 13px;
  font-weight: 500;              /* â† å…³é”®ï¼šä¸ç²— */
  letter-spacing: .2px;
  box-shadow: 0 8px 18px rgba(17,24,39,.08);
}

/* ===== ä¸»æŒ‰é’® ===== */

/* æ·»åŠ åˆ°åˆ—è¡¨ï¼šæ·±ç°è€Œä¸æ˜¯çº¯é»‘ */
.btnPrimary{
  background: rgba(17,24,39,.90);
  color: #fff;
  -webkit-text-fill-color: #fff;
}

/* ===== Ghost æŒ‰é’® ===== */
.btnGhost{
  background: rgba(255,255,255,.7);
  border: 1px solid rgba(255,255,255,.85);
  color: #111827;
  -webkit-text-fill-color: #111827;
}

/* ===== å±é™©æŒ‰é’® ===== */

/* æ¸…ç©ºå…¨éƒ¨ï¼šæŸ”å’Œçº¢ */
.btnDanger{
  background: linear-gradient(135deg, #ff6b6b, #ff8b8b);
  color: #fff;
  -webkit-text-fill-color: #fff;
}

/* ===== å¤‡ä»½åŒºï¼šä¸¤è¡Œå››ä¸ªï¼Œå°å°ºå¯¸ ===== */
.backupRow{
  flex-wrap: wrap;
  justify-content: center;
  margin-top: 10px;
}

.backupRow button{
  flex: 0 0 calc(50% - 8px);
  padding: 9px 8px;
  font-size: 13px;
  font-weight: 500;
  border-radius: 14px;
}

/* ===== mini æŒ‰é’®é¢å¤–æ”¶ç´§ ===== */
.btnMini{
  font-size: 13px;
}
/* List */
    .listHead{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      margin-bottom: 10px;
    }
    .listHint{
      color: var(--muted);
      font-size: 12px;
    }
    table{
      width:100%;
      border-collapse: separate;
      border-spacing: 0;
      overflow:hidden;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,.85);
      background: rgba(255,255,255,.70);
      box-shadow: 0 10px 24px rgba(40,20,90,.06);
    }
    thead th{
      text-align:left;
      font-size: 13px;
      color: var(--muted);
      padding: 12px 12px;
      border-bottom: 1px solid rgba(200,210,255,.35);
      background: rgba(255,255,255,.55);
      white-space:nowrap;
    }
    tbody td{
      padding: 12px 12px;
      border-bottom: 1px solid rgba(200,210,255,.25);
      font-size: 14px;
      vertical-align: middle;
    }
    tbody tr:last-child td{ border-bottom:none; }
    .ops{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .tagYear{
      display:inline-flex;
      align-items:center;
      padding: 4px 8px;
      border-radius: 999px;
      font-size: 12px;
      color: #374151;
      background: rgba(108,99,255,.12);
      border: 1px solid rgba(108,99,255,.18);
      margin-left: 8px;
      white-space:nowrap;
    }
    .muted{ color: var(--muted); }

    .toast{
      position: fixed;
      left: 50%;
      bottom: 16px;
      transform: translateX(-50%);
      background: rgba(20,20,30,.92);
      color:#fff;
      padding: 10px 14px;
      border-radius: 999px;
      font-size: 13px;
      opacity: 0;
      pointer-events:none;
      transition: opacity .18s ease, transform .18s ease;
      z-index: 9999;
    }
    .toast.on{
      opacity: 1;
      transform: translateX(-50%) translateY(-2px);
    }
    .smallLine{
      margin-top: 10px;
      color: var(--muted);
      font-size: 12px;
      line-height:1.35;
    }

    .debugLine{
      margin-top: 8px;
      font-size: 12px;
      color: rgba(92,97,112,.85);
    }

/* ====== 1) â€œæ·»åŠ è®°å½•â€æ ‡é¢˜è¡Œï¼šå·¦æ ‡é¢˜ + å³ä¾§å¹´ä»½ä¸‹æ‹‰ å¼ºåˆ¶åŒä¸€è¡Œå¯¹é½ ====== */
/* å…¼å®¹ä¸åŒå‘½åï¼šheaderRow / formHead / formHeader / addHead / headRow */
.headerRow, .formHead, .formHeader, .addHead, .headRow{
  display: flex !important;
  align-items: center !important;          /* å‚ç›´å±…ä¸­ */
  justify-content: space-between !important;/* å·¦å³è´´è¾¹ */
  gap: 12px !important;
}

/* å¦‚æœä½ çš„æ ‡é¢˜æ˜¯ h2 / h3 / .sectionTitle */
.headerRow h2, .headerRow h3,
.formHead h2, .formHead h3,
.formHeader h2, .formHeader h3,
.addHead h2, .addHead h3,
.headRow h2, .headRow h3,
.sectionTitle{
  margin: 0 !important;
  line-height: 1.2 !important;
}

/* å³ä¸Šè§’ä¸‹æ‹‰ï¼šå›ºå®šé«˜åº¦ã€é¿å…æŠŠè¡Œæ’‘æ­ª */
.headerRow select, .formHead select, .formHeader select, .addHead select, .headRow select,
#yearFilter{
  height: 36px !important;
  padding: 0 12px !important;
  border-radius: 999px !important;
  line-height: 36px !important;
  white-space: nowrap !important;
}

/* å¦‚æœå³ä¾§ä¸‹æ‹‰å¤–é¢åŒ…äº†ä¸€ä¸ªå®¹å™¨ï¼ˆå¸¸è§ï¼š.rightTools / .selectWrapï¼‰ä¹Ÿä¸€èµ·å¯¹é½ */
.rightTools, .selectWrap{
  display: flex !important;
  align-items: center !important;
  gap: 10px !important;
}

/* ====== 2) ç»Ÿè®¡å¡ç‰‡ï¼šä¸‰æ ¼ç­‰å®½ï¼Œä¿è¯åŒé«˜åº¦ï¼ŒåŒå¯¹é½ ====== */
.stats{
  display: grid !important;
  grid-template-columns: repeat(3, 1fr) !important;
  gap: 12px !important;
  align-items: stretch !important;
}
.stats .stat, .stats .card, .stats .box{
  min-height: 92px !important;
  display: flex !important;
  flex-direction: column !important;
  justify-content: center !important;
  align-items: center !important;
  text-align: center !important;
}

/* ====== 3) æŒ‰é’®è¡Œï¼šé¿å…æŒ‰é’®é«˜ä½ä¸é½ ====== */
.actionsRow, .btnRow, .formActions{
  display: flex !important;
  gap: 12px !important;
  align-items: center !important;
  flex-wrap: wrap !important;
}
.actionsRow button, .btnRow button, .formActions button{
  height: 42px !important;
  border-radius: 999px !important;
}

/* ====== 4) å¡ç‰‡å†…æ§ä»¶å®½åº¦ï¼šè®©è¾“å…¥æ¡†å’Œæ˜Ÿæ˜ŸåŒºæ›´æ•´é½ ====== */
input[type="text"], input[type="number"]{
  width: 100% !important;
  box-sizing: border-box !important;
}

/* â‘  æ“ä½œæŒ‰é’®ï¼šä¸‰é¢—åŒæ’ï¼ˆç§»åŠ¨ç«¯ï¼‰ */
.actionRow{
  display:flex;
  gap:10px;
  align-items:center;
  flex-wrap:nowrap;      /* å¼ºåˆ¶åŒä¸€è¡Œ */
}
.actionRow .btn{
  flex:1 1 0;            /* ä¸‰ä¸ªå¹³å‡åˆ†é… */
  min-width:0;
  white-space:nowrap;
  font-size:14px;
  padding:12px 10px;
  border-radius:16px;
}

/* æ›´çª„å±å†å°ä¸€ç‚¹ */
@media (max-width: 420px){
  .actionRow{ gap:8px; }
  .actionRow .btn{
    font-size:13px;
    padding:11px 8px;
    border-radius:15px;
  }
}
.sortSelect{
  font-size: 12px;
  padding: 6px 10px;
  border-radius: 999px;
  border: 1px solid rgba(0,0,0,.08);
  background: rgba(255,255,255,.85);
}

/* ===== æ“ä½œåŒºä¸‰æŒ‰é’®ï¼šæœ€ç»ˆç‰ˆï¼ˆæŒ‰ class å‘½ä¸­ï¼Œä¸é  idï¼‰===== */

/* åªå½±å“â€œæ·»åŠ åˆ°åˆ—è¡¨/æ¸…ç©ºè¾“å…¥/æ¸…ç©ºå…¨éƒ¨â€è¿™ä¸€è¡ŒæŒ‰é’® */
.actionRow button{
  font-weight: 500 !important;          /* å˜ç»†ï¼šä¸å†ç²—é»‘ */
  font-size: 14px !important;
  box-shadow: 0 6px 14px rgba(17,24,39,.08) !important;
  -webkit-appearance: none !important;
  appearance: none !important;
  text-decoration: none !important;
}

/* === æ·»åŠ  / æ¸…ç©º / æ¸…ç©ºå…¨éƒ¨ï¼šæœ€ç»ˆè§†è§‰ç‰ˆ === */
.btnRow.actionRow > button{
  font-size: 13px !important;
  font-weight: 400 !important;
  color: #374151 !important;
  -webkit-text-fill-color: #374151 !important;
  box-shadow: 0 4px 10px rgba(0,0,0,.08) !important;
}

.btnRow.actionRow .btnPrimary{
  background: linear-gradient(135deg, #1f2937, #111827);
  color: #f9fafb !important;
  font-weight: 400 !important;
}

.btnRow.actionRow .btnGhost{
  background: rgba(255,255,255,.85);
  border: 1px solid rgba(0,0,0,.06);
}

.btnRow.actionRow .btnDanger{
  background: linear-gradient(135deg, #fb7185, #f87171);
  color: #fff !important;
  font-weight: 400 !important;
}

/* ä¸»æŒ‰é’®ï¼šæ·»åŠ åˆ°åˆ—è¡¨ï¼ˆç™½å­—ï¼‰ */
.btnRow.actionRow .btnPrimary{
  background: linear-gradient(135deg, #1f2937, #111827);
  color: #ffffff !important;
  -webkit-text-fill-color: #ffffff !important;
  font-weight: 400;
}

/* å±é™©æŒ‰é’®ï¼šæ¸…ç©ºå…¨éƒ¨ï¼ˆç™½å­—ï¼‰ */
.btnRow.actionRow .btnDanger{
  background: linear-gradient(135deg, #fb7185, #f87171);
  color: #ffffff !important;
  -webkit-text-fill-color: #ffffff !important;
  font-weight: 400;
}

  
/* ===== é˜²æ­¢ iPhone æ¨ªå‘â€œå‡ºç•Œâ€/å·¦å³æ»‘åŠ¨ï¼ˆå¼ºåŠ›ç‰ˆï¼Œä¸æ”¹å˜è§†è§‰ï¼‰ ===== */
html, body{
  width:100%;
  max-width:100vw;
  overflow-x: clip;
}
@supports not (overflow: clip){
  html, body{ overflow-x:hidden; }
}
/* Grid/Flex å­é¡¹å…è®¸æ”¶ç¼©ï¼Œé¿å…è¢«é•¿æ–‡æœ¬æ’‘å‡º */
.grid > *, .top > *, .sectionTitle > *, .listHead > *{
  min-width: 0;
}
/* é•¿å­—ç¬¦ä¸²ï¼ˆä¾‹å¦‚å­˜å‚¨keyï¼‰è‡ªåŠ¨æ¢è¡Œï¼Œé¿å…æ’‘å‡ºæ¨ªå‘ */
.debugLine, .smallLine, .subtitle, .chip, .listHint{
  overflow-wrap: anywhere;
  word-break: break-word;
}
/* å¤‡ä»½æŒ‰é’®åŒºåŸŸï¼šä¸¤åˆ—ç½‘æ ¼ï¼Œä¸”ä¸å…è®¸æ’‘å‡º */
.backupGrid{
  display:grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 10px;
  margin-top: 12px;
}
.backupGrid button{
  width:100%;
  min-width:0;
  white-space: nowrap;
}
/* ===== æ‰‹æœºç«¯æœ€ç»ˆå¸ƒå±€ï¼šä¹¦åä¸ä¸¢ã€â­ä¸ä¸å¤©æ•°/åˆ†é’Ÿé‡å ã€æ•´ä½“è¾¹è·æ›´ç´§ï¼ˆåªå½±å“æ‰‹æœºï¼‰ ===== */
html, body{ overflow-x: hidden; }
@media (max-width: 520px){
  /* é˜²æ­¢ä¸»å±å¹• Web App / Safari å‡ºç°æ¨ªå‘æ»‘åŠ¨ */
  html, body{ overflow-x: clip; }

  /* æ•´é¡µå·¦å³è¾¹è·è¿›ä¸€æ­¥æ”¶ç´§ï¼ˆæ›´æ¥è¿‘ä½ åŸæ¥çš„é‚£ç‰ˆï¼‰ */
  .wrap{ padding-left: 2px !important; padding-right: 2px !important; }

  /* åªæ”¶ç´§â€œè®°å½•åˆ—è¡¨â€è¿™å¼ å¡ï¼ˆä¸å½±å“ä¸Šé¢æ·»åŠ è®°å½•åŒºï¼‰ */
  #listCard{ padding-left: 2px !important; padding-right: 2px !important; }

  /* è¡¨æ ¼ï¼šå›ºå®šå¸ƒå±€ + æ˜ç¡®åˆ—å®½ï¼Œä¿è¯ä¸é‡å ï¼ˆâ­ä¸æ¢è¡Œï¼‰ */
  #listCard table.recordsTable{ table-layout: fixed !important; width: 100% !important; }
  #listCard table.recordsTable col:nth-child(1){ width: 32px !important; }  /* # */
  #listCard table.recordsTable col:nth-child(3){ width: 110px !important; } /* â­ï¼ˆä¸€è¡Œ5æ˜Ÿä¹Ÿæ”¾å¾—ä¸‹ï¼‰ */
  #listCard table.recordsTable col:nth-child(4){ width: 52px !important; }  /* å¤©æ•° */
  #listCard table.recordsTable col:nth-child(5){ width: 62px !important; }  /* åˆ†é’Ÿ */
  #listCard table.recordsTable col:nth-child(6){ width: 86px !important; }  /* æ“ä½œ */

  /* è¡¨å¤´/å•å…ƒæ ¼å†…è¾¹è·æ›´ç´§ï¼Œé¿å…è¢«â€œæ’‘å®½â€ */
  #listCard thead th{ padding: 10px 4px !important; font-size: 12px !important; white-space: nowrap !important; }
  #listCard tbody td{ padding: 10px 4px !important; font-size: 13px !important; vertical-align: middle !important; }

  /* ä¹¦åï¼šå…è®¸è‡ªç„¶æ¢è¡Œï¼Œä¸è¦å˜ç«–æ¡ */
  #listCard td:nth-child(2) div{
    white-space: normal !important;
    overflow-wrap: break-word !important;
    word-break: normal !important;
    hyphens: auto;
  }

  /* â­ï¼šé å·¦ã€ä¸”ä¸æ¢è¡Œï¼ˆå…³é”®ï¼‰ï¼Œæ°¸è¿œä¸å‹åˆ°å¤©æ•°/åˆ†é’Ÿ */
  #listCard th:nth-child(3),
  #listCard td:nth-child(3){
    text-align: left !important;
    padding-left: 0px !important;
    white-space: nowrap !important;
    word-break: normal !important;
    line-height: 1.1 !important;
  }

  /* å¤©æ•°/åˆ†é’Ÿå±…ä¸­æ›´æ¸…æ¥š */
  #listCard th:nth-child(4), #listCard td:nth-child(4),
  #listCard th:nth-child(5), #listCard td:nth-child(5){
    text-align: center !important;
    white-space: nowrap !important;
  }

  /* æ“ä½œåˆ—ï¼šä¿æŒæ˜¾ç¤ºã€æŒ‰é’®ä¸è¢«æŒ¤æ²¡ */
  #listCard th:nth-child(6), #listCard td:nth-child(6){
    text-align: right !important;
    white-space: nowrap !important;
  }
}



/* ===== v15: è®°å½•åˆ—è¡¨æ‰‹æœºç«¯åˆ—å®½/é—´è·æœ€ç»ˆä¿®å¤ï¼ˆâ­ä¸æ¢è¡Œ+æ›´é å·¦ï¼Œç¼–è¾‘/åˆ é™¤ä¸¤è¡Œæ›´çœç©ºé—´ï¼‰ ===== */
@media (max-width: 520px){
  /* é¡µé¢æ•´ä½“å·¦å³å†æ”¶ç´§ä¸€ç‚¹ */
  .wrap{ padding-left: 10px !important; padding-right: 10px !important; }

  /* ä»…æ”¶ç´§â€œè®°å½•åˆ—è¡¨â€å¡ç‰‡å†…éƒ¨å·¦å³ç•™ç™½ */
  #listCard{ padding-left: 0px !important; padding-right: 0px !important; }

  /* è¡¨æ ¼ï¼šé‡æ–°åˆ†é…åˆ—å®½ï¼Œç»™â€œä¹¦å+â­â€æ›´å¤šç©ºé—´ */
  #listCard table.recordsTable{ table-layout: fixed !important; width: 100% !important; }
  #listCard table.recordsTable col:nth-child(1){ width: 30px !important; }   /* # */
  #listCard table.recordsTable col:nth-child(3){ width: 92px !important; }   /* â­ï¼šä¸€è¡Œ 1-5 æ˜Ÿ */
  #listCard table.recordsTable col:nth-child(4){ width: 40px !important; }   /* å¤©æ•° */
  #listCard table.recordsTable col:nth-child(5){ width: 46px !important; }   /* åˆ†é’Ÿ */
  #listCard table.recordsTable col:nth-child(6){ width: 64px !important; }   /* æ“ä½œï¼šä¸¤è¡Œå°å­— */

  /* è¡¨å¤´ï¼šä¹¦åä¸å†è¢«æŒ¤åˆ°åªå‰©â€œåâ€ï¼Œå¿…è¦æ—¶çœç•¥å· */
  #listCard th:nth-child(2){
    white-space: nowrap !important;
    overflow: hidden !important;
    text-overflow: ellipsis !important;
  }

  /* â­ï¼šæ›´é å·¦ï¼Œä¸”æ°¸ä¸æ¢è¡Œ */
  #listCard th:nth-child(3),
  #listCard td:nth-child(3){
    text-align: left !important;
    padding-left: 0px !important;
    padding-right: 2px !important;
    white-space: nowrap !important;
  }

  /* å¤©æ•°/åˆ†é’Ÿï¼šé è¿‘æ“ä½œåˆ—ä¸€ç‚¹ */
  #listCard th:nth-child(4), #listCard td:nth-child(4),
  #listCard th:nth-child(5), #listCard td:nth-child(5){
    text-align: right !important;
    padding-right: 6px !important;
  }

  /* æ“ä½œåˆ—ï¼šç¼–è¾‘/åˆ é™¤ä¸¤è¡Œï¼Œå­—ä½“æ›´å°ï¼ŒèŠ‚çœæ¨ªå‘ç©ºé—´ */
  #listCard td:nth-child(6){ padding-left: 2px !important; padding-right: 2px !important; }
  #listCard td:nth-child(6) .ops{
    display: flex !important;
    flex-direction: column !important;
    gap: 6px !important;
    align-items: flex-end !important;
    justify-content: center !important;
  }
  #listCard td:nth-child(6) .btnMini{
    font-size: 11px !important;
    padding: 6px 8px !important;
    line-height: 1.05 !important;
    min-width: 0 !important;
  }
}

</style>
</head>

<body>
  <div class="wrap">
    <div class="hero">
      <div class="top">
        <div class="badge">ğŸ“š</div>
        <div style="flex:1">
          <h1>Yoyi-Reading</h1>
          <p class="subtitle">è®°å½•ä¸€æœ¬ä¹¦çš„é˜…è¯»å¤©æ•°ã€æ€»æ—¶é•¿å’Œå–œçˆ±åº¦ï¼ˆ1â€“5â­ï¼‰</p>
          <div class="chips">
            <div class="chip">é€‚åˆå­©å­</div>
            <div class="chip">è½»é‡è®°å½•</div>
            <div class="chip">çœ‹å¾—è§ç§¯ç´¯ âœ¨</div>
          </div>
          <div class="debugLine" id="initLine"></div>
        </div>
      </div>

      <div class="grid">
        <!-- Left: Form + Stats -->
        <div class="card">
          <div class="sectionTitle">
            <h2>â• æ·»åŠ è®°å½•</h2>
            <div class="rightTools">
              <div class="selectWrap">
                <select id="yearFilter" class="select" title="æŒ‰å¹´ç­›é€‰">
                  <option value="ALL">å…¨éƒ¨å¹´ä»½</option>
                </select>
              </div>
            </div>
          </div>

          <div class="formGrid">
            <div>
              <label>ä¹¦å</label>
              <input id="titleInput" placeholder="ä¾‹å¦‚ï¼šWho Was...?" maxlength="120" />
            </div>

            <div>
              <label>å–œçˆ±åº¦</label>
              <div class="stars" id="starBar" aria-label="å–œçˆ±åº¦æ˜Ÿæ˜Ÿ">
                <div class="starBtn" data-v="1">â­</div>
                <div class="starBtn" data-v="2">â­</div>
                <div class="starBtn" data-v="3">â­</div>
                <div class="starBtn" data-v="4">â­</div>
                <div class="starBtn" data-v="5">â­</div>
                <div class="starNote">ç‚¹æ˜Ÿæ˜Ÿé€‰æ‹©ï¼ˆå¯ä¸é€‰ï¼‰</div>
              </div>
            </div>

            <div class="row2">
              <div>
                <label>é˜…è¯»å¤©æ•°ï¼ˆæ•°å­—ï¼‰</label>
                <input id="daysInput" inputmode="numeric" placeholder="ä¾‹å¦‚ï¼š2" />
              </div>
              <div>
                <label>é˜…è¯»æ€»æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰</label>
                <input id="minsInput" inputmode="numeric" placeholder="ä¾‹å¦‚ï¼š35" />
              </div>
            </div>

            <div class="btnRow actionRow">
              <button class="btnPrimary" id="addBtn">æ·»åŠ åˆ°åˆ—è¡¨</button>
              <button class="btnGhost" id="clearBtn">æ¸…ç©ºè¾“å…¥</button>
              <button class="btnDanger" id="clearAllBtn">æ¸…ç©ºå…¨éƒ¨</button>
            </div>

            <div class="stats" id="statsGrid">
              <div class="stat">
                <div class="v" id="statBooks">0</div>
                <div class="k">ç´¯è®¡æœ¬æ•°</div>
              </div>
              <div class="stat">
                <div class="v" id="statDays">0</div>
                <div class="k">ç´¯è®¡å¤©æ•°</div>
              </div>
              <div class="stat">
                <div class="v" id="statMins">0</div>
                <div class="k">ç´¯è®¡æ—¶é•¿</div>
              </div>
            </div>

            <div class="smallLine">
              æç¤ºï¼šä¸»å±å¹•å›¾æ ‡ï¼ˆWeb Appï¼‰å’Œ Safari é“¾æ¥å¯èƒ½æ˜¯ä¸¤ä»½ä¸åŒçš„æœ¬åœ°æ•°æ®ã€‚æ—¥å¸¸è¯·ä»ä¸»å±å¹•æ‰“å¼€ï¼›æ”¹ä»£ç å‰å…ˆå¤‡ä»½ä¸€æ¬¡ä¼šæ›´å®‰å¿ƒã€‚
            </div>

            <input id="restoreFileInput" type="file" accept="application/json" style="display:none;" />
          </div>
        </div>

        <!-- Right: List -->
        <div class="card" id="listCard" id="listCard">
          <div class="sectionTitle">
            <h2>ğŸ—‚ï¸ è®°å½•åˆ—è¡¨</h2>
            <div class="rightTools">
              <span class="listHint" id="listHint">å¯ç¼–è¾‘ / åˆ é™¤</span>
            </div>
          </div>

     <div class="listHead">
  <div class="listHint" id="listMeta"></div>
  <div class="ops">
    <select id="sortSelect" class="sortSelect">
      <option value="new">æœ€æ–°åœ¨å‰</option>
      <option value="old">æœ€æ—©åœ¨å‰</option>
    </select>
  </div>
</div>

          <div style="overflow:auto; border-radius:16px;">
            <table class="recordsTable">
              <colgroup>
                <col style="width:8%">
                <col style="width:44%">
                <col style="width:14%">
                <col style="width:10%">
                <col style="width:12%">
                <col style="width:12%">
              </colgroup>
              <thead>
                <tr>
                  <th style="width:70px;">#</th>
                  <th>ä¹¦å</th>
                  <th style="width:70px;">â­</th>
                  <th style="width:80px;">å¤©æ•°</th>
                  <th style="width:90px;">åˆ†é’Ÿ</th>
                  <th style="width:140px; text-align:right;">æ“ä½œ</th>
                </tr>
              </thead>
              <tbody id="tbody"></tbody>
            </table>
          </div>

          <div class="smallLine muted" id="emptyTip" style="display:none; margin-top:10px;">
            è¿˜æ²¡æœ‰è®°å½•ã€‚å…ˆæ·»åŠ ä¸€æœ¬åˆ°åˆ—è¡¨å§ ğŸ™‚
          </div>

<div class="backupGrid">
  <button class="btnGhost btnMini" id="backupJsonBtn">ğŸ—‚ï¸ å¤‡ä»½(JSON)</button>
  <button class="btnGhost btnMini" id="restoreJsonBtn">ğŸ“¥ æ¢å¤(JSON)</button>
  <button class="btnGhost btnMini" id="backupClipBtn">ğŸ“‹ å¤‡ä»½(å‰ªè´´æ¿)</button>
  <button class="btnGhost btnMini" id="restoreClipBtn">ğŸ“‹ æ¢å¤(å‰ªè´´æ¿)</button>
</div>

        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    /**********************
     * 0) å®‰å…¨å­˜å‚¨ç­–ç•¥ï¼ˆé˜²ä¸¢ï¼‰
     * - è‡ªåŠ¨è¯†åˆ«ä½ åŸå…ˆä½¿ç”¨çš„ localStorage keyï¼ˆä¸å¼ºè¡Œæ”¹ï¼‰
     * - åŒæ—¶é•œåƒå­˜ä¸€ä»½åˆ°å›ºå®š keyï¼šyoyi_reading_log_v1ï¼ˆé¢å¤–ä¿é™©ï¼‰
     **********************/
    const MIRROR_KEY = "yoyi_reading_log_v1"; // æˆ‘ä»¬çš„â€œä¿é™©é•œåƒâ€
    let ACTIVE_KEY = null;                    // è‡ªåŠ¨è¯†åˆ«å‡ºæ¥çš„â€œåŸå§‹ keyâ€
    let state = {
      version: 1,
      items: []   // {id,title,stars,days,mins,createdAt}
    };

    // è¯†åˆ«ï¼šå“ªäº› localStorage é¡¹å¯èƒ½æ˜¯æˆ‘ä»¬çš„æ•°æ®
    function looksLikeReadingData(obj){
      if (!obj || typeof obj !== "object") return false;

      // æ”¯æŒå¤šç§ç»“æ„ï¼š{items:[...]} æˆ–ç›´æ¥æ˜¯æ•°ç»„
      const items = Array.isArray(obj) ? obj : obj.items;
      if (!Array.isArray(items)) return false;

      // å°è¯•æ£€æŸ¥å‰å‡ æ¡æ˜¯å¦æœ‰ title å­—æ®µï¼ˆæˆ–ä¹¦åå­—æ®µï¼‰
      const sample = items.slice(0, 3);
      for (const it of sample){
        if (!it || typeof it !== "object") continue;
        const t = it.title ?? it.bookTitle ?? it.name ?? it.BookTitle;
        if (typeof t === "string" && t.trim().length > 0) return true;
      }
      // ç©ºæ•°ç»„ä¹Ÿè§†ä¸ºå¯ç”¨ç»“æ„ï¼ˆä½†ä¼˜å…ˆçº§ä½ï¼‰
      return items.length === 0;
    }

    function parseMaybeJSON(raw){
      try { return JSON.parse(raw); } catch(e){ return null; }
    }

    // ä» localStorage è‡ªåŠ¨å¯»æ‰¾â€œæœ€åƒâ€çš„é‚£æ¡è®°å½•æ•°æ®
    function findBestKey(){
      // 1) å…ˆçœ‹é•œåƒ key
      const mirrorRaw = localStorage.getItem(MIRROR_KEY);
      const mirrorObj = mirrorRaw ? parseMaybeJSON(mirrorRaw) : null;
      if (mirrorObj && looksLikeReadingData(mirrorObj)) return MIRROR_KEY;

      // 2) æ‰«ææ‰€æœ‰ key
      const keys = [];
      for (let i=0;i<localStorage.length;i++){
        const k = localStorage.key(i);
        if (k) keys.push(k);
      }

      // ä¼˜å…ˆåŒ…å« reading / log / star / yoyi çš„ key
      const preferred = keys.sort((a,b)=>{
        const score = (k)=>{
          const s = k.toLowerCase();
          let p=0;
          if (s.includes("yoyi")) p+=5;
          if (s.includes("reading")) p+=4;
          if (s.includes("log")) p+=3;
          if (s.includes("star")) p+=2;
          return p;
        };
        return score(b)-score(a);
      });

      for (const k of preferred){
        const raw = localStorage.getItem(k);
        if (!raw) continue;
        const obj = parseMaybeJSON(raw);
        if (obj && looksLikeReadingData(obj)) return k;
      }

      return MIRROR_KEY; // éƒ½æ²¡æœ‰å°±ç”¨é•œåƒ key æ–°å»º
    }

    function normalizeToState(obj){
      // å…è®¸ obj æ˜¯æ•°ç»„ / æˆ– {items:[...]} / æˆ–å…¶å®ƒåŒ…è£¹å½¢å¼
      let items = [];
      if (Array.isArray(obj)) items = obj;
      else if (obj && Array.isArray(obj.items)) items = obj.items;
      else items = [];

      const norm = items.map((it, idx)=>{
        const title = (it.title ?? it.bookTitle ?? it.name ?? "").toString();
        const stars = Number(it.stars ?? it.rating ?? it.star ?? 0) || 0;
        const days  = Number(it.days ?? it.day ?? it.readDays ?? 0) || 0;
        const mins  = Number(it.mins ?? it.minutes ?? it.readMinutes ?? 0) || 0;
        const createdAt = it.createdAt ?? it.date ?? it.created ?? it.ts ?? null;

        return {
          id: (it.id ?? cryptoRandomId()),
          title: title.trim(),
          stars: clamp(stars, 0, 5),
          days: Math.max(0, Math.floor(days)),
          mins: Math.max(0, Math.floor(mins)),
          createdAt: normalizeTime(createdAt) ?? Date.now() // æ²¡æœ‰å°±è¡¥ä¸€ä¸ª
        };
      }).filter(it => it.title.length > 0);

      return { version: 1, items: norm };
    }

    function readFromKey(key){
      const raw = localStorage.getItem(key);
      if (!raw) return null;
      const obj = parseMaybeJSON(raw);
      if (!obj) return null;

      // æœ‰äº›å¤‡ä»½æ ¼å¼å¯èƒ½æ˜¯ {data: {...}}
      if (obj && obj.data) return normalizeToState(obj.data);
      return normalizeToState(obj);
    }

    function writeState(){
      // å†™å› ACTIVE_KEYï¼ˆä¿æŒä½ åŸæ¥é‚£ä»½æ•°æ®åœ¨ï¼‰
      const payload = JSON.stringify(state);

      try{
        localStorage.setItem(ACTIVE_KEY, payload);
      }catch(e){
        // å­˜å‚¨æ»¡äº†çš„æƒ…å†µ
        toast("âš ï¸ ä¿å­˜å¤±è´¥ï¼šæœ¬åœ°å­˜å‚¨ç©ºé—´å¯èƒ½æ»¡äº†");
        console.warn(e);
      }

      // é¢å¤–é•œåƒä¸€ä»½ï¼ˆä¿é™©ï¼‰
      try{
        localStorage.setItem(MIRROR_KEY, payload);
      }catch(e){
        console.warn("Mirror save failed:", e);
      }
    }

    function init(){
      ACTIVE_KEY = findBestKey();
      const loaded = readFromKey(ACTIVE_KEY);
      state = loaded ?? { version: 1, items: [] };

      // å¦‚æœ ACTIVE_KEY ä¸æ˜¯é•œåƒ keyï¼Œä¹ŸæŠŠå®ƒé•œåƒä¸€ä»½ï¼ˆä¿é™©ï¼‰
      writeState();

      document.getElementById("initLine").textContent =
        `å­˜å‚¨ï¼š${ACTIVE_KEY === MIRROR_KEY ? "ä¸»å­˜å‚¨" : "å·²è¯†åˆ«åŸå­˜å‚¨"}ï¼ˆå®‰å…¨é•œåƒå·²å¼€å¯ï¼‰`;

      rebuildYearOptions();
      renderAll();
    }

    /**********************
     * 1) å·¥å…·å‡½æ•°
     **********************/
    function clamp(n, a, b){ return Math.max(a, Math.min(b, n)); }

    function cryptoRandomId(){
      // iOS Safari æ”¯æŒ crypto.getRandomValues
      const buf = new Uint32Array(2);
      crypto.getRandomValues(buf);
      return "id_" + buf[0].toString(16) + buf[1].toString(16);
    }

    function normalizeTime(v){
      if (!v) return null;
      if (typeof v === "number") return v;
      // å°è¯•è§£ææ—¥æœŸå­—ç¬¦ä¸²
      const t = Date.parse(v);
      if (!Number.isNaN(t)) return t;
      return null;
    }

    function formatHM(totalMins){
      const h = Math.floor(totalMins / 60);
      const m = totalMins % 60;
      return `${totalMins} (${h}h ${m}m)`;
    }

    function getYearFromItem(it){
      try{
        const d = new Date(it.createdAt);
        const y = d.getFullYear();
        if (!Number.isFinite(y)) return null;
        return y;
      }catch(e){
        return null;
      }
    }

    function toast(msg){
      const el = document.getElementById("toast");
      el.textContent = msg;
      el.classList.add("on");
      setTimeout(()=> el.classList.remove("on"), 1600);
    }

    /**********************
     * 2) å¹´ä»½ç­›é€‰
     **********************/
    function rebuildYearOptions(){
      const sel = document.getElementById("yearFilter");

      const current = sel.value || "ALL";
      const years = new Set();
      for (const it of state.items){
        const y = getYearFromItem(it);
        if (y) years.add(y);
      }
      const arr = Array.from(years).sort((a,b)=>b-a);

      // æ¸…ç©ºï¼ˆä¿ç•™ ALLï¼‰
      sel.innerHTML = `<option value="ALL">å…¨éƒ¨å¹´ä»½</option>` + arr.map(y=>`<option value="${y}">${y}</option>`).join("");

      // å°½é‡ä¿ç•™åŸé€‰æ‹©
      if ([...sel.options].some(o=>o.value===current)){
        sel.value = current;
      }else{
        sel.value = "ALL";
      }
    }

    function getFilteredItems(){
      const sel = document.getElementById("yearFilter").value;
      if (sel === "ALL") return state.items.slice();
      const y = Number(sel);
      return state.items.filter(it => getYearFromItem(it) === y);
    }

    /**********************
     * 3) æ¸²æŸ“
     **********************/
    let sortMode = "NEW"; // NEW / OLD

    function renderAll(){
      // å¹´ä»½ä¸‹æ‹‰ä¼šéšæ–°å¢å˜åŒ–
      rebuildYearOptions();
      renderStatsAndList();
    }

    function renderStatsAndList(){
      const items = getFilteredItems();
      const totalBooks = items.length;
      const totalDays = items.reduce((s,it)=> s + (it.days||0), 0);
      const totalMins = items.reduce((s,it)=> s + (it.mins||0), 0);

      document.getElementById("statBooks").textContent = totalBooks;
      document.getElementById("statDays").textContent  = totalDays;
      document.getElementById("statMins").textContent  = formatHM(totalMins);

      const sel = document.getElementById("yearFilter").value;
      const meta = sel === "ALL"
        ? `æ˜¾ç¤ºï¼šå…¨éƒ¨è®°å½•ï¼ˆå…± ${totalBooks} æœ¬ï¼‰`
        : `æ˜¾ç¤ºï¼š${sel} å¹´ï¼ˆå…± ${totalBooks} æœ¬ï¼‰`;
      document.getElementById("listMeta").textContent = meta;

      // æ’åº
      const sorted = items.slice().sort((a,b)=>{
        return sortMode === "NEW" ? (b.createdAt - a.createdAt) : (a.createdAt - b.createdAt);
      });

      // è¡¨æ ¼
      const tb = document.getElementById("tbody");
      tb.innerHTML = "";

      document.getElementById("emptyTip").style.display = (sorted.length===0) ? "block" : "none";

      sorted.forEach((it, idx)=>{
        const tr = document.createElement("tr");

        const y = getYearFromItem(it);
        const yearTag = y ? `<span class="tagYear">${y}</span>` : "";

        tr.innerHTML = `
          <td>${idx+1}</td>
          <td>
            <div style="font-weight:800">${escapeHtml(it.title)} ${yearTag}</div>
            <div class="muted" style="font-size:12px; margin-top:4px;">
              ${new Date(it.createdAt).toLocaleDateString()}
            </div>
          </td>
          <td>${it.stars ? "â­".repeat(it.stars) : "â€”"}</td>
          <td>${it.days || 0}</td>
          <td>${it.mins || 0}</td>
          <td style="text-align:right;">
            <div class="ops">
              <button class="btnGhost btnMini" data-act="edit" data-id="${it.id}">ç¼–è¾‘</button>
              <button class="btnDanger btnMini" data-act="del" data-id="${it.id}">åˆ é™¤</button>
            </div>
          </td>
        `;
        tb.appendChild(tr);
      });

      // ç»‘å®šæ“ä½œæŒ‰é’®
      tb.querySelectorAll("button").forEach(btn=>{
        btn.addEventListener("click", ()=>{
          const id = btn.getAttribute("data-id");
          const act = btn.getAttribute("data-act");
          if (act === "del") deleteItem(id);
          if (act === "edit") startEdit(id);
        });
      });
    }

    function escapeHtml(s){
      return String(s).replace(/[&<>"']/g, m => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"
      }[m]));
    }

    /**********************
     * 4) æ·»åŠ /ç¼–è¾‘/åˆ é™¤
     **********************/
    let starValue = 0;
    let editingId = null;

    function setStars(v){
      starValue = clamp(Number(v)||0, 0, 5);
      document.querySelectorAll("#starBar .starBtn").forEach(el=>{
        const n = Number(el.getAttribute("data-v"));
        el.classList.toggle("on", starValue >= n && starValue>0);
      });
    }

    function clearInputs(){
      document.getElementById("titleInput").value = "";
      document.getElementById("daysInput").value = "";
      document.getElementById("minsInput").value = "";
      setStars(0);
      editingId = null;
      document.getElementById("addBtn").textContent = "æ·»åŠ åˆ°åˆ—è¡¨";
      toast("å·²æ¸…ç©ºè¾“å…¥");
    }

    function addOrSave(){
      const title = document.getElementById("titleInput").value.trim();
      const daysRaw = document.getElementById("daysInput").value.trim();
      const minsRaw = document.getElementById("minsInput").value.trim();

      if (!title){
        toast("è¯·è¾“å…¥ä¹¦å");
        return;
      }

      const days = daysRaw ? Math.max(0, Math.floor(Number(daysRaw))) : 0;
      const mins = minsRaw ? Math.max(0, Math.floor(Number(minsRaw))) : 0;

      if (editingId){
        const it = state.items.find(x=>x.id===editingId);
        if (!it){
          toast("æ‰¾ä¸åˆ°è¦ç¼–è¾‘çš„è®°å½•");
          editingId = null;
          return;
        }
        it.title = title;
        it.days = days;
        it.mins = mins;
        it.stars = starValue;
        // createdAt ä¸æ”¹ï¼ˆä¿æŒåŸå§‹å¹´ä»½ï¼‰
        writeState();
        renderAll();
        toast("å·²ä¿å­˜ä¿®æ”¹");
        clearInputs();
        return;
      }

      const now = Date.now();
      state.items.push({
        id: cryptoRandomId(),
        title,
        stars: starValue,
        days,
        mins,
        createdAt: now
      });

      writeState();
      renderAll();
      toast("å·²æ·»åŠ  âœ…");
      clearInputs();
    }

    function deleteItem(id){
      const it = state.items.find(x=>x.id===id);
      if (!it) return;
      const ok = confirm(`ç¡®å®šåˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ\n\n${it.title}`);
      if (!ok) return;

      state.items = state.items.filter(x=>x.id!==id);
      writeState();
      renderAll();
      toast("å·²åˆ é™¤");
    }

    function startEdit(id){
      const it = state.items.find(x=>x.id===id);
      if (!it) return;

      editingId = id;
      document.getElementById("titleInput").value = it.title;
      document.getElementById("daysInput").value = it.days || 0;
      document.getElementById("minsInput").value = it.mins || 0;
      setStars(it.stars || 0);

      document.getElementById("addBtn").textContent = "ä¿å­˜ä¿®æ”¹";
      toast("ç¼–è¾‘ä¸­ï¼šä¿®æ”¹åç‚¹â€œä¿å­˜ä¿®æ”¹â€");
      window.scrollTo({ top: 0, behavior: "smooth" });
    }

    function clearAll(){
      const ok = confirm("âš ï¸ ç¡®å®šæ¸…ç©ºå…¨éƒ¨è®°å½•å—ï¼Ÿ\nï¼ˆå¼ºçƒˆå»ºè®®å…ˆå¤‡ä»½ JSONï¼‰");
      if (!ok) return;

      state.items = [];
      writeState();
      renderAll();
      toast("å·²æ¸…ç©ºå…¨éƒ¨");
    }

    /**********************
     * 5) å¤‡ä»½/æ¢å¤ï¼ˆJSON æ–‡ä»¶ + å‰ªè´´æ¿ï¼‰
     **********************/
    function backupToJsonFile(){
      // å¯¼å‡ºæ—¶ç”¨ç»Ÿä¸€ç»“æ„ï¼Œæ–¹ä¾¿æœªæ¥å…¼å®¹
      const payload = {
        _meta: {
          app: "Yoyi-Reading",
          version: 1,
          exportedAt: new Date().toISOString(),
          activeKey: ACTIVE_KEY,
          mirrorKey: MIRROR_KEY
        },
        data: state
      };

      const text = JSON.stringify(payload, null, 2);
      const blob = new Blob([text], { type: "application/json" });

      const d = new Date();
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,"0");
      const dd = String(d.getDate()).padStart(2,"0");
      const filename = `yoyi-reading-backup-${y}${m}${dd}.json`;

      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);

      toast("å·²ä¸‹è½½ JSON å¤‡ä»½");
    }

    async function restoreFromJsonFile(){
      const input = document.getElementById("restoreFileInput");
      input.value = "";
      input.click();

      input.onchange = async ()=>{
        const file = input.files && input.files[0];
        if (!file) return;

        try{
          const txt = await file.text();
          const obj = JSON.parse(txt);
          const data = obj && obj.data ? obj.data : obj;

          const norm = normalizeToState(data);
          state = norm;

          // å†™å›ä¸¤ä»½ï¼ˆåŸ key + é•œåƒï¼‰
          writeState();
          rebuildYearOptions();
          renderAll();
          toast("å·²ä» JSON æ¢å¤ âœ…");
          location.reload(); // è®© UI å…¨éƒ¨ä¸€è‡´
        }catch(e){
          console.warn(e);
          alert("æ¢å¤å¤±è´¥ï¼šæ–‡ä»¶ä¸æ˜¯æœ‰æ•ˆ JSON æˆ–æ ¼å¼ä¸å¯¹ã€‚");
        }
      };
    }

    async function backupToClipboard(){
      const payload = {
        _meta: {
          app: "Yoyi-Reading",
          version: 1,
          exportedAt: new Date().toISOString()
        },
        data: state
      };
      const text = JSON.stringify(payload);

      try{
        await navigator.clipboard.writeText(text);
        alert("âœ… å·²å¤‡ä»½åˆ°å‰ªè´´æ¿ã€‚\nè¯·ç²˜è´´ä¿å­˜åˆ°å¤‡å¿˜å½• / iCloud Notes / å¾®ä¿¡æ”¶è—ã€‚");
      }catch(e){
        // iOS å¯èƒ½æƒé™é—®é¢˜ï¼Œé€€å› prompt
        try{
          window.prompt("å¤åˆ¶ä¸‹é¢å†…å®¹ä¿å­˜ï¼ˆé•¿æŒ‰å…¨é€‰å¤åˆ¶ï¼‰", text);
        }catch(_){}
      }
    }

    async function restoreFromClipboard(){
      let text = "";
      try{
        text = await navigator.clipboard.readText();
      }catch(e){
        text = window.prompt("è¯·ç²˜è´´å¤‡ä»½å†…å®¹ï¼ˆJSON æ–‡æœ¬ï¼‰åˆ°è¿™é‡Œï¼š", "") || "";
      }
      if (!text.trim()){
        toast("æ²¡æœ‰å†…å®¹");
        return;
      }
      try{
        const obj = JSON.parse(text);
        const data = obj && obj.data ? obj.data : obj;

        state = normalizeToState(data);
        writeState();
        renderAll();
        toast("å·²ä»å‰ªè´´æ¿æ¢å¤ âœ…");
        location.reload();
      }catch(e){
        alert("æ¢å¤å¤±è´¥ï¼šå†…å®¹ä¸æ˜¯æœ‰æ•ˆ JSONã€‚");
      }
    }

    /**********************
     * 6) äº‹ä»¶ç»‘å®š
     **********************/
    // Stars click
    document.querySelectorAll("#starBar .starBtn").forEach(el=>{
      el.addEventListener("click", ()=>{
        const v = Number(el.getAttribute("data-v"));
        // å†ç‚¹åŒä¸€é¢—æ˜Ÿï¼šå–æ¶ˆè¯„åˆ†ï¼ˆå˜ä¸º 0ï¼‰
        if (starValue === v) setStars(0);
        else setStars(v);
      });
    });

    document.getElementById("addBtn").addEventListener("click", addOrSave);
    document.getElementById("clearBtn").addEventListener("click", clearInputs);
    document.getElementById("clearAllBtn").addEventListener("click", clearAll);
    document.getElementById("sortSelect").addEventListener("change", (e)=>{
      const v = e.target.value;
      sortMode = (v === "old") ? "OLD" : "NEW";
      renderStatsAndList();
    });

    document.getElementById("yearFilter").addEventListener("change", ()=>{
      renderStatsAndList();
    });

    document.getElementById("backupJsonBtn").addEventListener("click", backupToJsonFile);
    document.getElementById("restoreJsonBtn").addEventListener("click", restoreFromJsonFile);
    document.getElementById("backupClipBtn").addEventListener("click", backupToClipboard);
    document.getElementById("restoreClipBtn").addEventListener("click", restoreFromClipboard);

    // Enter to submit
    document.getElementById("minsInput").addEventListener("keydown", (e)=>{
      if (e.key === "Enter") addOrSave();
    });

    // Start
    init();

  </script>
</body>
</html>